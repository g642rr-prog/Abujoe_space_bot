import os
from telegram import ReplyKeyboardMarkup, Update
from telegram.ext import Application, CommandHandler, MessageHandler, ContextTypes, filters
from openai import OpenAI

# ====== 1) ูุฑุงุกุฉ ุงูุชูููุงุช ูู Environment Variables ======
BOT_TOKEN = os.getenv("BOT_TOKEN")
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")

client = OpenAI(api_key=OPENAI_API_KEY)

# ====== 2) ููุญุฉ ุงูููุงุชูุญ ุงูุฃุณุงุณูุฉ ======
keyboard = [
    ['๐ป ุจุฑุงูุฌ ุงูุณููุช ููุฑ', '๐ฐ ุงูุฃุฏูุงุช ุงูุตุญูุฉ'],
    ['๐ ุงุชุตู ุจูุง', '๐๏ธ ุทูุจ ุฎุฏูุฉ'],
    ['๐ข ุนู ุฃุจู ุฌู ููุชุทููุฑ ุงููุถุงุฆู']
]
reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

# ====== 3) ุฑุฏ AI ุฐูู ูุฑุงูู ุฒู ูุง ุงุชูููุง ======
async def ai_reply(message: str) -> str:
    response = client.chat.completions.create(
        model="gpt-4.1-mini",
        messages=[
            {"role": "system", "content": "ุฑุฏู ูููู ุฎููู ููุตุฑู ููุฑุญ ููุญุชุฑู ูุจุดูุด."},
            {"role": "user", "content": message}
        ]
    )
    return response.choices[0].message.content

# ====== 4) ุฑุณุงูุฉ ุงูุจุฏุงูุฉ ======
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.message.from_user
    welcome_text = f"""
๐ ุฃููุงู ุจูุฌู ุงููุถุงุก **{user.first_name}** ๐

๐ **ุฃุจู ุฌู ููุชุทููุฑ ุงููุถุงุฆู ูุงูุณููุช ููุฑ ูุงูุฃุฏูุงุช ุงูุตุญูุฉ**

ุฅุญูุง ููุง ูุฎุฏููุ ููููููุ ููุณุงุนุฏู ูุญุฏ ุขุฎุฑ ุงููุดูุงุฑ โค๏ธ  
ููู ุจุณ "ูุงูุง ุจููุง" ูุงูุง โ๏ธ ูุนุงู ููุด ูุณูุจู ุบูุฑ ูุงูุช ูุจุณูุท ๐

ุงุฎุชุงุฑ ููุน ุงูุฎุฏูุฉ ูู ุงููุงููุฉ ุงููู ุชุญุช ๐
"""
    await update.message.reply_text(welcome_text, reply_markup=reply_markup)

# ====== 5) ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ======
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text

    if text == '๐ป ุจุฑุงูุฌ ุงูุณููุช ููุฑ':
        response = """
๐ป **ุจุฑุงูุฌ ุงูุณููุช ููุฑ ุงููุชุงุญุฉ:**

โข ูุธุงู ูุญุงุณุจุฉ ูุงูู
โข ุฅุฏุงุฑุฉ ูุจูุนุงุช ููุฎุงุฒู
โข ููุงุฑุฏ ุจุดุฑูุฉ
โข ุฃูุธูุฉ ูุฎุตุตุฉ ุญุณุจ ุทูุจู

๐ ูููู:
**ุนุงูุฒ ุนุฑุถ ุณุนุฑ ุจุฑุงูุฌ**
"""

    elif text == '๐ฐ ุงูุฃุฏูุงุช ุงูุตุญูุฉ':
        response = """
๐ฐ **ุงูุฃุฏูุงุช ุงูุตุญูุฉ ุงููุชุงุญุฉ:**

โข ุฎูุงุทุงุช (ูุญูู - ุชุฑูู - ุฃูุฑูุจู)
โข ุฃุทูู ุญูุงูุงุช ูุงููุฉ
โข ููุงุณูุฑ ููุตูุงุช
โข ูุณุชูุฒูุงุช ุชุฑููุจ ูุตูุงูุฉ

โจ ูููู ุฃูููู ุนูู ุฃูุถู ุงูุฃููุงุน ุญุณุจ ุงุณุชุฎุฏุงูู ๐
"""

    elif text == '๐ ุงุชุตู ุจูุง':
        response = """
๐ **ูุณุงุฆู ุงูุงุชุตุงู:**

โข ูุงุชุณ: 01000000000  
โข ููุณุจูู: fb.com/abogroup  
โข ุงูุนููุงู: ูุตุฑ ุฃู ุงูุฏููุง ๐ช๐ฌ

๐ *ุฅุญูุง ููุฌูุฏูู ูุฃู ุฎุฏูุฉ ูุง ุตุงุญุจูุง โฅ๏ธ*
"""

    elif text == '๐๏ธ ุทูุจ ุฎุฏูุฉ':
        response = """
๐๏ธ ุชูุงู ูุง ูุญุชุฑู ๐ค

ูููู ููุน ุงูุฎุฏูุฉ ุงููุทููุจุฉ:
ูุซูุงู:
โข ุนุงูุฒ ุจุฑูุงูุฌ ูุญุงุณุจุฉ
โข ูุญุชุงุฌ ุฃุณุนุงุฑ ุฃุฏูุงุช ุตุญูุฉ
โข ุฃู ุญุชู ูุด ุนุงุฑู ุชุฎุชุงุฑ ูุนุงูุฒ ูุตูุญุฉ

ูุงูุง ูุนุงู ุฎุทูุฉ ุจุฎุทูุฉ ๐
"""

    elif text == '๐ข ุนู ุฃุจู ุฌู ููุชุทููุฑ ุงููุถุงุฆู':
        response = """
๐ข **ุฃุจู ุฌู ููุชุทููุฑ ุงููุถุงุฆู**

ูู 2014 ูุงุญูุง ุจูุฎุฏู ุงููุงุณ ุจุญุจ โฅ๏ธ  
ูุจููุฏููู:
โข ุญููู ุจุฑูุฌูุฉ ูููุงุนุฏ ุจูุงูุงุช
โข ุฃูุธูุฉ ุฅุฏุงุฑุฉ
โข ุชุฌุงุฑุฉ ุงูุฃุฏูุงุช ุงูุตุญูุฉ
โข ุฏุนู ููู ูุฎุฏูุฉ ูุงุจุนุฏ ุงูุจูุน

๐ฏ *ูุฏููุง ุงููุญูุฏ = ูุณุงุนุฏู ุชุชูุฏู*
"""

    else:
        # ุฃู ุฑุณุงูุฉ ุชุงููุฉ โ ูุฎูููุง ููู AI
        response = await ai_reply(text)

    await update.message.reply_text(response, reply_markup=reply_markup)

# ====== 6) ุชุดุบูู ุงูุจูุช ======
def main():
    print("๐ ุจูุช ุฃุจู ุฌู ุดุบุงู ููุณุชูู ุงููููู ูููุน ...")
    app = Application.builder().token(BOT_TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    app.run_polling()

if __name__ == "__main__":
    main()
